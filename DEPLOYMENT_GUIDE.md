# ä½“è‚²èµ›äº‹çˆ¬è™« - LinuxæœåŠ¡å™¨éƒ¨ç½²æŒ‡å—

## ğŸ“– æ¦‚è¿°

`comprehensive_deploy.sh` æ˜¯ä¸€ä¸ªå®Œæ•´çš„LinuxæœåŠ¡å™¨éƒ¨ç½²è„šæœ¬ï¼Œé›†æˆäº†æ‰€æœ‰ä¿®å¤æ–¹æ¡ˆå’Œå†²çªè§£å†³ã€‚æ”¯æŒä»¥ä¸‹ç³»ç»Ÿï¼š

- âœ… Ubuntu/Debian
- âœ… CentOS/RHEL  
- âœ… é˜¿é‡Œäº‘Linux
- âœ… Fedora

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### 1. ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨

```bash
# æ–¹æ³•1ï¼šä½¿ç”¨scp
scp -r /path/to/spider-puppeteer user@server:/tmp/

# æ–¹æ³•2ï¼šä½¿ç”¨rsync (æ¨è)
rsync -avz --exclude='node_modules' --exclude='.git' \
    /path/to/spider-puppeteer/ user@server:/tmp/spider-puppeteer/

# æ–¹æ³•3ï¼šgit clone
ssh user@server
git clone https://github.com/yourusername/spider-puppeteer.git
cd spider-puppeteer
```

### 2. æ‰§è¡Œéƒ¨ç½²è„šæœ¬

```bash
# SSHç™»å½•æœåŠ¡å™¨
ssh user@server

# è¿›å…¥é¡¹ç›®ç›®å½•
cd /tmp/spider-puppeteer

# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x comprehensive_deploy.sh

# æ‰§è¡Œéƒ¨ç½² (æ ‡å‡†éƒ¨ç½²)
./comprehensive_deploy.sh

# æˆ–è€…ï¼Œåˆ›å»ºsystemdæœåŠ¡
./comprehensive_deploy.sh --systemd
```

## ğŸ”§ éƒ¨ç½²åŠŸèƒ½

### è‡ªåŠ¨æ£€æµ‹å’Œä¿®å¤
- âœ… **ç³»ç»Ÿå…¼å®¹æ€§æ£€æµ‹** - è‡ªåŠ¨è¯†åˆ«Ubuntu/CentOS/é˜¿é‡Œäº‘Linux/Fedora
- âœ… **EPELä»“åº“å†²çªä¿®å¤** - ä¸“é—¨è§£å†³é˜¿é‡Œäº‘æœåŠ¡å™¨çš„åŒ…å†²çªé—®é¢˜
- âœ… **åŒ…åé€‚é…** - è‡ªåŠ¨é€‚é…ä¸åŒç³»ç»Ÿçš„åŒ…åå·®å¼‚
- âœ… **èµ„æºæ£€æŸ¥** - å†…å­˜ã€ç£ç›˜ç©ºé—´æ£€æŸ¥ï¼Œè‡ªåŠ¨åˆ›å»ºäº¤æ¢æ–‡ä»¶
- âœ… **æƒé™éªŒè¯** - æ£€æŸ¥ç”¨æˆ·æƒé™ï¼Œé¿å…rootç”¨æˆ·è¿è¡Œ

### ä¾èµ–å®‰è£…
- âœ… **Node.js 18.x** - è‡ªåŠ¨å®‰è£…å’Œç‰ˆæœ¬æ£€æŸ¥
- âœ… **ç³»ç»Ÿä¾èµ–** - å®Œæ•´çš„Puppeteerè¿è¡Œç¯å¢ƒ
- âœ… **Google Chrome** - å¤šç§å®‰è£…æ–¹å¼ï¼ŒåŒ…å«å¤‡ç”¨æ–¹æ¡ˆ
- âœ… **PM2è¿›ç¨‹ç®¡ç†å™¨** - ç”Ÿäº§ç¯å¢ƒè¿›ç¨‹ç®¡ç†
- âœ… **é¡¹ç›®ä¾èµ–** - npmåŒ…è‡ªåŠ¨å®‰è£…å’ŒéªŒè¯

### æœåŠ¡é…ç½®
- âœ… **é¡¹ç›®ç›®å½•è®¾ç½®** - æ ‡å‡†åŒ–éƒ¨ç½²åˆ° `/var/www/spider-puppeteer`
- âœ… **ç¯å¢ƒé…ç½®** - è‡ªåŠ¨ç”Ÿæˆ `.env` é…ç½®æ–‡ä»¶
- âœ… **é˜²ç«å¢™é…ç½®** - è‡ªåŠ¨é…ç½®ç«¯å£3000è®¿é—®æƒé™
- âœ… **æ•°æ®åº“è¿æ¥æµ‹è¯•** - éªŒè¯æ•°æ®åº“é…ç½®
- âœ… **æœåŠ¡å¯åŠ¨éªŒè¯** - ç¡®ä¿æœåŠ¡æ­£å¸¸è¿è¡Œ

## ğŸ“‹ éƒ¨ç½²åç®¡ç†

éƒ¨ç½²å®Œæˆåï¼Œè„šæœ¬ä¼šåœ¨ `/var/www/spider-puppeteer` ç›®å½•åˆ›å»ºä»¥ä¸‹ç®¡ç†è„šæœ¬ï¼š

### åŸºæœ¬ç®¡ç†
```bash
./start.sh      # å¯åŠ¨æœåŠ¡
./stop.sh       # åœæ­¢æœåŠ¡  
./restart.sh    # é‡å¯æœåŠ¡
./status.sh     # æŸ¥çœ‹çŠ¶æ€
```

### æ—¥å¿—ç®¡ç†
```bash
./logs.sh pm2      # æŸ¥çœ‹PM2æ—¥å¿—
./logs.sh batch    # æŸ¥çœ‹æ‰¹é‡å¤„ç†æ—¥å¿—
./logs.sh monitor  # æŸ¥çœ‹ç›‘æ§æ—¥å¿—
./logs.sh all      # æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
```

### ç»´æŠ¤ç®¡ç†
```bash
./update.sh     # æ›´æ–°ä»£ç å’Œä¾èµ–
./test.sh       # è¿è¡ŒåŠŸèƒ½æµ‹è¯•
./backup.sh     # å¤‡ä»½æ•°æ®å’Œé…ç½®
```

### PM2ç›´æ¥å‘½ä»¤
```bash
pm2 status                    # æŸ¥çœ‹è¿›ç¨‹çŠ¶æ€
pm2 logs spider-server        # æŸ¥çœ‹å®æ—¶æ—¥å¿—
pm2 monit                     # æ€§èƒ½ç›‘æ§
pm2 restart spider-server     # é‡å¯æœåŠ¡
```

## ğŸ› ï¸ æ•…éšœæ’é™¤

### 1. æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—
```bash
cat /tmp/spider_deploy.log
```

### 2. å¸¸è§é—®é¢˜

#### EPELä»“åº“å†²çª (å·²è‡ªåŠ¨ä¿®å¤)
```bash
# è„šæœ¬ä¼šè‡ªåŠ¨å¤„ç†ä»¥ä¸‹é—®é¢˜ï¼š
Error: conflicting requests
- package epel-aliyuncs-release conflicts with epel-release
```

#### åŒ…åä¸åŒ¹é… (å·²è‡ªåŠ¨é€‚é…)
```bash
# è„šæœ¬ä¼šè‡ªåŠ¨é€‚é…ä¸åŒç³»ç»Ÿçš„åŒ…åï¼š
- google-chrome-stable (æ ‡å‡†ç³»ç»Ÿ)
- noto-fonts-cjk â†’ google-noto-*-cjk-fonts (é˜¿é‡Œäº‘)
- libXss â†’ libXScrnSaver (é˜¿é‡Œäº‘)
```

#### Chromeå®‰è£…å¤±è´¥
```bash
# è„šæœ¬æä¾›å¤šç§å¤‡ç”¨æ–¹æ¡ˆï¼š
1. ä»“åº“å®‰è£… â†’ 2. ç›´æ¥ä¸‹è½½RPM â†’ 3. å®‰è£…Chromium â†’ 4. ä½¿ç”¨Puppeteerå†…ç½®æµè§ˆå™¨
```

#### å†…å­˜ä¸è¶³
```bash
# è„šæœ¬ä¼šè‡ªåŠ¨åˆ›å»ºäº¤æ¢æ–‡ä»¶
free -h  # æ£€æŸ¥å†…å­˜å’Œäº¤æ¢æ–‡ä»¶
```

### 3. æ‰‹åŠ¨è¯Šæ–­
```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /var/www/spider-puppeteer

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
./status.sh

# è¿è¡Œæµ‹è¯•
./test.sh

# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
./logs.sh pm2
```

## âš™ï¸ é…ç½®æ–‡ä»¶

### ç¯å¢ƒé…ç½® (.env)
```env
NODE_ENV=production
PORT=3000
HEADLESS=true
REQUEST_DELAY=1000
MAX_RETRIES=3

# æ•°æ®åº“é…ç½® (éœ€è¦æ‰‹åŠ¨ä¿®æ”¹)
DB_HOST=localhost
DB_USER=spider
DB_PASSWORD=your_password
DB_NAME=sports_data
```

### PM2é…ç½® (ecosystem.config.js)
- è‡ªåŠ¨é‡å¯
- æ—¥å¿—ç®¡ç†
- å†…å­˜é™åˆ¶
- å®šæ—¶é‡å¯

## ğŸ“Š ç³»ç»Ÿè¦æ±‚

### æœ€ä½è¦æ±‚
- **æ“ä½œç³»ç»Ÿ**: Linux (Ubuntu/CentOS/é˜¿é‡Œäº‘Linux/Fedora)
- **å†…å­˜**: 1GB (å»ºè®®2GB+)
- **ç£ç›˜**: 5GBå¯ç”¨ç©ºé—´
- **ç½‘ç»œ**: èƒ½è®¿é—®å¤–ç½‘

### æ¨èé…ç½®
- **å†…å­˜**: 2GB+
- **CPU**: 2æ ¸+
- **ç£ç›˜**: 10GB+

## ğŸ” å®‰å…¨å»ºè®®

1. **ä½¿ç”¨æ™®é€šç”¨æˆ·è¿è¡Œ** - é¿å…ä½¿ç”¨rootç”¨æˆ·
2. **é…ç½®é˜²ç«å¢™** - è„šæœ¬ä¼šè‡ªåŠ¨é…ç½®ç«¯å£3000
3. **å®šæœŸæ›´æ–°** - ä½¿ç”¨ `./update.sh` æ›´æ–°ä»£ç 
4. **å¤‡ä»½æ•°æ®** - ä½¿ç”¨ `./backup.sh` å®šæœŸå¤‡ä»½
5. **ç›‘æ§æ—¥å¿—** - å®šæœŸæŸ¥çœ‹ `./logs.sh` ç›‘æ§å¼‚å¸¸

## ğŸ“ æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. æ£€æŸ¥éƒ¨ç½²æ—¥å¿—: `/tmp/spider_deploy.log`
2. è¿è¡Œè¯Šæ–­: `./status.sh` å’Œ `./test.sh`
3. æŸ¥çœ‹æœåŠ¡æ—¥å¿—: `./logs.sh pm2`
4. é‡å¯æœåŠ¡: `./restart.sh`

---

**ğŸ‰ æ­å–œï¼** ç°åœ¨æ‚¨å¯ä»¥ä½¿ç”¨ `comprehensive_deploy.sh` ä¸€é”®éƒ¨ç½²ä½“è‚²èµ›äº‹çˆ¬è™«åˆ°ä»»ä½•æ”¯æŒçš„LinuxæœåŠ¡å™¨ï¼ 